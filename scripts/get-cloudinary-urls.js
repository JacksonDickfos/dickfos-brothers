// Script to fetch all Cloudinary image URLs
// Run with: node scripts/get-cloudinary-urls.js

const cloudinary = require('cloudinary').v2;
const fs = require('fs');
const path = require('path');

// Configure Cloudinary with your credentials
// Get these from: Cloudinary Dashboard > Settings > Product Environment
cloudinary.config({
  cloud_name: 'ddozmtseo',
  api_key: process.env.CLOUDINARY_API_KEY || 'YOUR_API_KEY',
  api_secret: process.env.CLOUDINARY_API_SECRET || 'YOUR_API_SECRET',
});

async function getAllImageUrls() {
  try {
    console.log('Fetching all images from Cloudinary...');
    
    let allResources = [];
    let nextCursor = null;
    
    // Fetch all images using Admin API (returns max 500 per request, so we paginate)
    do {
      const result = await cloudinary.api.resources({
        resource_type: 'image',
        type: 'upload',
        max_results: 500,
        next_cursor: nextCursor,
      });
      
      allResources = allResources.concat(result.resources);
      nextCursor = result.next_cursor;
      
      console.log(`Fetched ${allResources.length} images so far...`);
    } while (nextCursor);
    
    console.log(`\nTotal images found: ${allResources.length}`);
    
    // Extract URLs - generate clean URLs without extra query params
    const urls = allResources.map(resource => {
      // Get the secure URL with explicit format
      const url = cloudinary.url(resource.public_id, {
        secure: true,
        resource_type: 'image',
        fetch_format: 'auto',
        quality: 'auto',
      });
      // Remove any query parameters that might cause issues
      return url.split('?')[0];
    });
    
    // Generate the TypeScript array format
    const tsArray = `export const heroImageUrls: string[] = [\n${urls.map(url => `  "${url}",`).join('\n')}\n];`;
    
    // Write to file
    const outputPath = path.join(__dirname, '../src/data/heroImages.ts');
    fs.writeFileSync(outputPath, `// Cloudinary image URLs for the hero section\n// Auto-generated by get-cloudinary-urls.js\n// Total images: ${urls.length}\n\n${tsArray}\n`);
    
    console.log(`\nâœ… Success! Generated ${urls.length} URLs`);
    console.log(`ðŸ“ Written to: ${outputPath}`);
    console.log(`\nFirst few URLs:`);
    urls.slice(0, 3).forEach((url, i) => console.log(`  ${i + 1}. ${url}`));
    
  } catch (error) {
    console.error('âŒ Error fetching images:', error.message);
    console.error('\nMake sure you have:');
    console.error('1. Set CLOUDINARY_API_KEY and CLOUDINARY_API_SECRET environment variables, OR');
    console.error('2. Updated the script with your API credentials');
    console.error('\nGet your credentials from: Cloudinary Dashboard > Settings > Product Environment');
    process.exit(1);
  }
}

getAllImageUrls();
